(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1627:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>u});var i=t(5155),s=t(2115),l=t(5417);let r=()=>(0,l.createBrowserClient)("https://zlbkspsokztxaioztigk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpsYmtzcHNva3p0eGFpb3p0aWdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MDcxODksImV4cCI6MjA4MzI4MzE4OX0.hh6RJkGO_c-QnFPbO8UmLrf8lB6-OMKDnK2_CCyLTnQ");var n=t(5239),d=t(9962);function c(e){let{product:a,mode:t}=e,{addToCart:l,items:r}=(0,d._)(),[c,o]=(0,s.useState)(!1),m="agen_kecil"===t,u=m?12:1,p=r.some(e=>e.id!==a.id);return(0,i.jsxs)("article",{className:"bg-white rounded-lg shadow-sm overflow-hidden border border-gray-100 flex flex-col h-full",children:[(0,i.jsx)("div",{className:"h-40 bg-gray-100 w-full relative overflow-hidden",children:a.image_url&&!c?(0,i.jsx)(n.default,{src:a.image_url,alt:a.name,fill:!0,sizes:"(max-width: 640px) 100vw, 50vw",className:"object-cover",onError:()=>o(!0)}):(0,i.jsx)("div",{className:"text-gray-400 text-sm flex items-center justify-center h-full",children:"No Image"})}),(0,i.jsxs)("div",{className:"p-3 flex-1 flex flex-col",children:[(0,i.jsx)("h2",{className:"text-sm font-semibold text-gray-900 line-clamp-2",children:a.name}),(0,i.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:a.category}),m&&!p&&(0,i.jsx)("div",{className:"mb-2 text-xs text-green-700",children:"Agen Kecil aktif: beli 12 pcs untuk mendapatkan harga agen"}),m&&p&&(0,i.jsx)("div",{className:"mb-2 text-xs text-red-600",children:"Agen Kecil tidak berlaku saat ada lebih dari 1 produk di keranjang"}),(0,i.jsxs)("div",{className:"mt-auto flex items-center justify-between gap-3",children:[(0,i.jsxs)("div",{className:"text-blue-600 font-bold",children:["Rp ",a.price.toLocaleString("id-ID")]}),(0,i.jsx)("button",{onClick:()=>l({id:a.id,name:a.name,price:a.price,image:a.image_url},u),className:"px-3 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 touch-manipulation","aria-label":"Tambah ".concat(a.name," ke keranjang"),children:"Tambah"})]})]})]})}let o={consumer:{tierName:"Consumer",multiplier:1,label:"Konsumen"},dropshipper:{tierName:"Dropshipper",multiplier:1,label:"Dropshipper"},agen_kecil:{tierName:"Agen Kecil",multiplier:1,label:"Agen Kecil"},silver:{tierName:"Silver",multiplier:12,label:"Silver (12 pcs)"},gold:{tierName:"Gold",multiplier:30,label:"Gold (30 pcs)"},platinum:{tierName:"Platinum",multiplier:100,label:"Platinum (100 pcs)"}},m={silver:6366e3,gold:13905e3,platinum:375e5};function u(){let[e,a]=(0,s.useState)([]),[t,l]=(0,s.useState)(!0),[n,u]=(0,s.useState)("consumer"),p=r();(0,s.useEffect)(()=>{!async function(){l(!0);let{data:e}=await p.from("products").select("id, name, image_url, category, sold_count"),{tierName:t}=o[n],{data:i}=await p.from("tiers").select("id").eq("name",t).single();if(e){let t=e.map(e=>({...e,price:0}));if(i){let{data:a}=await p.from("product_prices").select("product_id, price").eq("tier_id",i.id);t=e.map(e=>{let t=null==a?void 0:a.find(a=>a.product_id===e.id);return{...e,price:(null==t?void 0:t.price)||0}})}else{let{data:a}=await p.from("tiers").select("id").eq("name","Consumer").single();if(a){let{data:i}=await p.from("product_prices").select("product_id, price").eq("tier_id",a.id);t=e.map(e=>{let a=null==i?void 0:i.find(a=>a.product_id===e.id);return{...e,price:(null==a?void 0:a.price)||0}})}}a(t)}l(!1)}()},[p,n]);let x=o[n].multiplier,h=e.reduce((e,a)=>e+a.price*x,0),g=m[n],b=g?h-g:null,{items:f,totalPrice:j,addToCart:v}=(0,d._)(),[y,k]=(0,s.useState)(null),[N,w]=(0,s.useState)({}),[S,_]=(0,s.useState)({}),[C,I]=(0,s.useState)(!1),[P,E]=(0,s.useState)(!1),[z,O]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{if(!C)return;let e=!0;return E(!0),(async()=>{try{var a,t;let i=r(),s=await i.auth.getSession(),l=null==s||null==(t=s.data)||null==(a=t.session)?void 0:a.access_token,n=await fetch("/api/packages",l?{headers:{authorization:"Bearer ".concat(l)}}:void 0),d=await n.json();if(!e)return;let c={};(d.packages||[]).forEach(e=>{c[e.name]=e.skus||[]}),w(c),_(c),void 0!==d.is_admin&&O(!!d.is_admin)}catch(e){}finally{e&&E(!1)}})(),()=>{e=!1}},[C]),(0,s.useEffect)(()=>{if("agen_kecil"===n&&f.length>1){u("consumer");let e=Math.max(0,m.silver-j);k("Harga Agen Kecil hanya berlaku untuk pembelian 1 produk (12 pcs). Anda menambahkan produk lain sehingga harga kembali normal. Untuk mendapat keuntungan agen, pertimbangkan menjadi Agen Silver — selisih Rp ".concat(e.toLocaleString("id-ID"),"."))}},[f,n,j]),(0,i.jsxs)("main",{children:[(0,i.jsxs)("header",{className:"mb-4",children:[(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Katalog Produk"}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("label",{htmlFor:"mode",className:"sr-only",children:"Mode Pembelian"}),(0,i.jsxs)("select",{id:"mode",value:n,onChange:e=>u(e.target.value),className:"text-sm rounded-md border border-gray-200 px-2 py-1",children:[(0,i.jsx)("option",{value:"consumer",children:"Konsumen"}),(0,i.jsx)("option",{value:"dropshipper",children:"Dropshipper"}),(0,i.jsx)("option",{value:"agen_kecil",children:"Agen Kecil"}),(0,i.jsx)("option",{value:"silver",children:"Silver (12 pcs)"}),(0,i.jsx)("option",{value:"gold",children:"Gold (30 pcs)"}),(0,i.jsx)("option",{value:"platinum",children:"Platinum (100 pcs)"})]}),(0,i.jsx)("button",{onClick:()=>I(!0),className:"ml-2 text-sm px-2 py-1 rounded-md border border-gray-200 text-gray-700",children:"Kelola Paket"}),x>1&&(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,i.jsxs)("div",{children:["Total paket (",o[n].label,"): ",(0,i.jsxs)("span",{className:"font-semibold",children:["Rp ",h.toLocaleString("id-ID")]}),(0,i.jsx)("button",{onClick:()=>{e.forEach(e=>{v({id:e.id,name:e.name,price:e.price,image:e.image_url},x)})},className:"ml-3 px-3 py-1 bg-blue-600 text-white rounded text-sm",children:"Beli Paket"})]}),g&&(0,i.jsxs)("div",{className:"mt-1 text-xs",children:["Target paket: ",(0,i.jsxs)("span",{className:"font-medium",children:["Rp ",g.toLocaleString("id-ID")]}),(0,i.jsx)("span",{className:"ml-2 ".concat(1e3>Math.abs(b)?"text-green-600":"text-red-600"),children:0===b?" (Sesuai)":" (Selisih Rp ".concat(Math.abs(b).toLocaleString("id-ID"),")")})]})]})]})]}),(0,i.jsxs)("div",{className:"mt-3 flex items-center justify-between gap-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-sm text-gray-500",children:"Filter:"}),(0,i.jsx)("button",{className:"text-sm px-2 py-1 rounded-md border border-gray-200 text-gray-700",children:"Kategori"}),(0,i.jsx)("button",{className:"text-sm px-2 py-1 rounded-md border border-gray-200 text-gray-700",children:"Harga"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"sort",className:"sr-only",children:"Sort"}),(0,i.jsxs)("select",{id:"sort",className:"text-sm rounded-md border border-gray-200 px-2 py-1",children:[(0,i.jsx)("option",{value:"popular",children:"Populer"}),(0,i.jsx)("option",{value:"price_asc",children:"Harga: Rendah → Tinggi"}),(0,i.jsx)("option",{value:"price_desc",children:"Harga: Tinggi → Rendah"})]})]})]}),y&&(0,i.jsx)("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:(0,i.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,i.jsx)("div",{children:y}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("button",{className:"text-xs text-blue-600",onClick:()=>{var a="silver";let t=N[a]&&N[a].length>0?N[a]:e.map(e=>e.id),i=o[a].multiplier;t.forEach(a=>{let t=e.find(e=>e.id===a);t&&v({id:t.id,name:t.name,price:t.price,image:t.image_url},i)}),k("".concat(a[0].toUpperCase()+a.slice(1)," paket ditambahkan ke keranjang.")),I(!1),k(null)},children:"Menjadi Agen Silver"}),(0,i.jsx)("button",{className:"text-xs text-gray-600",onClick:()=>k(null),children:"Tutup"})]})]})})]}),C&&(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:(0,i.jsxs)("div",{className:"bg-white rounded-md p-4 w-full max-w-3xl",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,i.jsx)("h3",{className:"font-semibold",children:"Kelola Paket (Silver / Gold / Platinum)"}),(0,i.jsx)("button",{className:"text-sm text-gray-600",onClick:()=>I(!1),children:"Tutup"})]}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:["silver","gold","platinum"].map(a=>(0,i.jsxs)("div",{className:"p-2 border border-gray-100 rounded",children:[(0,i.jsx)("h4",{className:"text-sm font-medium mb-2",children:a.toUpperCase()}),P?(0,i.jsx)("div",{className:"text-xs text-gray-500",children:"Memuat…"}):(0,i.jsx)("div",{className:"max-h-40 overflow-auto space-y-2",children:e.map(e=>(0,i.jsxs)("label",{className:"flex items-center gap-2 text-xs",children:[(0,i.jsx)("input",{type:"checkbox",checked:(S[a]||[]).includes(e.id),onChange:t=>{let i=t.target.checked;_(t=>{let s={...t};return s[a]=s[a]?[...s[a]]:[],i?s[a].includes(e.id)||s[a].push(e.id):s[a]=s[a].filter(a=>a!==e.id),s})}}),(0,i.jsx)("span",{children:e.name})]},e.id))})]},a))}),(0,i.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,i.jsx)("button",{className:"px-3 py-1 border rounded",onClick:()=>I(!1),children:"Batal"}),z?(0,i.jsx)("button",{className:"px-3 py-1 bg-blue-600 text-white rounded",onClick:async()=>{try{var e,a;let t=r(),i=await t.auth.getSession(),s=null==i||null==(a=i.data)||null==(e=a.session)?void 0:e.access_token;if(!s)throw Error("auth required");if(!(await fetch("/api/packages",{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer ".concat(s)},body:JSON.stringify({name:"silver",skus:S.silver||[]})})).ok)throw Error("failed to save");await fetch("/api/packages",{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer ".concat(s)},body:JSON.stringify({name:"gold",skus:S.gold||[]})}),await fetch("/api/packages",{method:"PUT",headers:{"content-type":"application/json",authorization:"Bearer ".concat(s)},body:JSON.stringify({name:"platinum",skus:S.platinum||[]})});let l=await (await fetch("/api/packages",s?{headers:{authorization:"Bearer ".concat(s)}}:void 0)).json(),n={};(l.packages||[]).forEach(e=>{n[e.name]=e.skus||[]}),w(n),_(n),I(!1),k("Paket tersimpan")}catch(e){k("Gagal menyimpan paket. Pastikan Anda login sebagai admin.")}},children:"Simpan Paket"}):(0,i.jsx)("div",{className:"text-xs text-gray-500 px-3 py-1",children:"Anda tidak memiliki izin untuk menyimpan paket. Login sebagai admin untuk menyimpan."})]})]})}),t?(0,i.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:Array.from({length:4}).map((e,a)=>(0,i.jsx)("div",{className:"h-44 bg-gray-100 rounded-md animate-pulse"},a))}):(0,i.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.map(e=>(0,i.jsx)(c,{product:e,mode:n},e.id))}),!t&&0===e.length&&(0,i.jsx)("p",{className:"text-center text-gray-500 mt-6",children:"Belum ada produk."})]})}},6349:(e,a,t)=>{Promise.resolve().then(t.bind(t,1627))},9962:(e,a,t)=>{"use strict";t.d(a,{CartProvider:()=>r,_:()=>n});var i=t(5155),s=t(2115);let l=(0,s.createContext)(void 0),r=e=>{let{children:a}=e,[t,r]=(0,s.useState)([]),[n,d]=(0,s.useState)(!1);(0,s.useEffect)(()=>{try{let e=localStorage.getItem("cart");e&&r(JSON.parse(e))}catch(e){}},[]),(0,s.useEffect)(()=>{localStorage.setItem("cart",JSON.stringify(t))},[t]);let c=t.reduce((e,a)=>e+a.quantity,0),o=t.reduce((e,a)=>e+a.price*a.quantity,0);return(0,i.jsx)(l.Provider,{value:{items:t,totalCount:c,totalPrice:o,cartOpen:n,openCart:()=>d(!0),closeCart:()=>d(!1),toggleCart:()=>d(e=>!e),addToCart:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;r(t=>{let i=t.findIndex(a=>a.id===e.id);if(i>=0){let e=[...t];return e[i].quantity+=a,e}return d(!0),[...t,{...e,quantity:a}]})},removeFromCart:e=>{r(a=>a.filter(a=>a.id!==e))},updateQuantity:(e,a)=>{r(t=>t.map(t=>t.id===e?{...t,quantity:Math.max(1,a)}:t))},clearCart:()=>r([])},children:a})},n=()=>{let e=(0,s.useContext)(l);if(!e)throw Error("useCart must be used within CartProvider");return e}}},e=>{e.O(0,[239,417,441,255,358],()=>e(e.s=6349)),_N_E=e.O()}]);